databases:
  - name: auth-db
    databaseName: auth_db
    plan: free

  - name: user-db
    databaseName: user_management
    plan: free

  - name: device-db
    databaseName: device_management
    plan: free

  - name: monitoring-db
    databaseName: monitoring_db
    plan: free

  - name: chat-db
    databaseName: chat_db
    plan: free

services:
  # RabbitMQ (using Docker image)
  - type: web
    name: rabbitmq
    plan: free
    runtime: image
    image:
      url: rabbitmq:3-management
    envVars:
      - key: RABBITMQ_DEFAULT_USER
        value: energy_user
      - key: RABBITMQ_DEFAULT_PASS
        value: energy_password

  # User Service
  - type: web
    name: user-service
    plan: free
    runtime: docker
    dockerfilePath: ./user-service/Dockerfile
    dockerContext: ./user-service
    envVars:
      - key: DB_HOST
        fromDatabase:
          name: user-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: user-db
          property: port
      - key: DB_NAME
        fromDatabase:
          name: user-db
          property: database
      - key: DB_USER
        fromDatabase:
          name: user-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: user-db
          property: password
      - key: PORT
        value: 3001
      - key: NODE_ENV
        value: production
      - key: DEVICE_SERVICE_URL
        fromService:
          name: device-service
          type: web
          property: host
      - key: RABBITMQ_URL
        sync: false

  # Auth Service
  - type: web
    name: auth-service
    plan: free
    runtime: docker
    dockerfilePath: ./auth-service/Dockerfile
    dockerContext: ./auth-service
    envVars:
      - key: DB_HOST
        fromDatabase:
          name: auth-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: auth-db
          property: port
      - key: DB_NAME
        fromDatabase:
          name: auth-db
          property: database
      - key: DB_USER
        fromDatabase:
          name: auth-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: auth-db
          property: password
      - key: PORT
        value: 3002
      - key: NODE_ENV
        value: production
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_REFRESH_SECRET
        generateValue: true
      - key: JWT_EXPIRES_IN
        value: 15m
      - key: JWT_REFRESH_EXPIRES_IN
        value: 7d
      - key: USER_SERVICE_URL
        sync: false
      - key: DEVICE_SERVICE_URL
        sync: false

  # Device Service
  - type: web
    name: device-service
    plan: free
    runtime: docker
    dockerfilePath: ./device-service/Dockerfile
    dockerContext: ./device-service
    envVars:
      - key: DB_HOST
        fromDatabase:
          name: device-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: device-db
          property: port
      - key: DB_NAME
        fromDatabase:
          name: device-db
          property: database
      - key: DB_USER
        fromDatabase:
          name: device-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: device-db
          property: password
      - key: PORT
        value: 3003
      - key: NODE_ENV
        value: production
      - key: RABBITMQ_URL
        sync: false

  # Monitoring Service
  - type: web
    name: monitoring-service
    plan: free
    runtime: docker
    dockerfilePath: ./monitoring-service/Dockerfile
    dockerContext: ./monitoring-service
    envVars:
      - key: DB_HOST
        fromDatabase:
          name: monitoring-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: monitoring-db
          property: port
      - key: DB_NAME
        fromDatabase:
          name: monitoring-db
          property: database
      - key: DB_USER
        fromDatabase:
          name: monitoring-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: monitoring-db
          property: password
      - key: PORT
        value: 3005
      - key: NODE_ENV
        value: production
      - key: RABBITMQ_URL
        sync: false
      - key: DEVICE_SERVICE_URL
        sync: false
      - key: DEVICE_ID
        value: "0"

  # WebSocket Service
  - type: web
    name: websocket-service
    plan: free
    runtime: docker
    dockerfilePath: ./websocket-service/Dockerfile
    dockerContext: ./websocket-service
    envVars:
      - key: PORT
        value: 3006
      - key: JWT_SECRET
        sync: false
      - key: RABBITMQ_URL
        sync: false

  # Chat Service
  - type: web
    name: chat-service
    plan: free
    runtime: docker
    dockerfilePath: ./chat-service/Dockerfile
    dockerContext: ./chat-service
    envVars:
      - key: DB_HOST
        fromDatabase:
          name: chat-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: chat-db
          property: port
      - key: DB_NAME
        fromDatabase:
          name: chat-db
          property: database
      - key: DB_USER
        fromDatabase:
          name: chat-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: chat-db
          property: password
      - key: PORT
        value: 3007
      - key: JWT_SECRET
        sync: false
      - key: RABBITMQ_URL
        sync: false
      - key: HUGGINGFACE_API_KEY
        sync: false

  # Load Balancer Service
  - type: web
    name: load-balancer-service
    plan: free
    runtime: docker
    dockerfilePath: ./load-balancer-service/Dockerfile
    dockerContext: ./load-balancer-service
    envVars:
      - key: PORT
        value: 3008
      - key: RABBITMQ_URL
        sync: false
      - key: DEVICE_SERVICE_URL
        sync: false
      - key: ENABLE_CONTAINER_SCALING
        value: "false"

  # Swagger Service
  - type: web
    name: swagger-service
    plan: free
    runtime: docker
    dockerfilePath: ./swagger-service/Dockerfile
    dockerContext: ./swagger-service
    envVars:
      - key: PORT
        value: 3004

  # API Gateway
  - type: web
    name: api-gateway
    plan: free
    runtime: docker
    dockerfilePath: ./api-gateaway/Dockerfile
    dockerContext: ./api-gateaway

  # Frontend
  - type: web
    name: frontend
    plan: free
    runtime: docker
    dockerfilePath: ./frontend/Dockerfile
    dockerContext: ./frontend
